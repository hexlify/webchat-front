(this["webpackJsonpwebchat-front"]=this["webpackJsonpwebchat-front"]||[]).push([[0],{190:function(e,t,n){},245:function(e,t,n){e.exports=n(386)},250:function(e,t,n){},285:function(e,t,n){},286:function(e,t,n){},287:function(e,t,n){},288:function(e,t,n){},289:function(e,t,n){},297:function(e,t,n){},298:function(e,t,n){},384:function(e,t,n){},385:function(e,t,n){},386:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(16),r=n.n(o),i=(n(250),n(157)),c=n(78),l=n(163),u=n(14),m=n(17),h=n(20),d=n(19),f=n(25),p=n(21),b=n(213),v=n.n(b),g=n(214),E=n.n(g),O=(n(285),function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"message".concat(this.props.isMine?" mine":"")},s.a.createElement("div",{className:"author-content"},this.props.isMine?"":this.props.author),s.a.createElement("div",{className:"message-content"},this.props.text))}}]),t}(a.Component)),y=(n(286),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).messagesEndRef=s.a.createRef(),n.scrollToBottom=n.scrollToBottom.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"scrollToBottom",value:function(){this.messagesEndRef.current.scrollIntoView({behavior:"smooth"})}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("div",{className:"message-list-container"},this.props.messages.map((function(e,t){return s.a.createElement(O,{key:t,isMine:e.isMine,author:e.sender,text:e.content})}))),s.a.createElement("div",{ref:this.messagesEndRef}))}}]),t}(a.Component));n(287);var j=function(e){var t=e.name,n=e.description,a=e.onClick;return t.length>25&&(t=t.slice(0,22)+"..."),n.length>25&&(n=n.slice(0,22)+"..."),s.a.createElement("div",{className:"conversation-list-item",onClick:a},s.a.createElement("h1",{className:"conversation-title"},t),s.a.createElement("p",{className:"conversation-desciption"},n))},k=(n(288),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).onItemChoice=n.onItemChoice.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"onItemChoice",value:function(e,t){this.props.chooseConversation(e)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"conversation-list"},this.props.conversations.map((function(t){return s.a.createElement(j,{key:t.id,name:t.name,description:t.description,onClick:function(n){return e.onItemChoice(t.id,n)}})})))}}]),t}(a.Component)),C=n(188),S=n(210),w=(n(289),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={message:""},n.onChange=n.onChange.bind(Object(f.a)(n)),n.onSubmit=n.onSubmit.bind(Object(f.a)(n)),n.onKeyPress=n.onKeyPress.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"onChange",value:function(e){e.preventDefault(),this.setState({message:e.target.value})}},{key:"onKeyPress",value:function(e){"Enter"===e.key&&this.onSubmit(e)}},{key:"onSubmit",value:function(e){this.state.message&&(this.props.onSubmitMessage(this.state.message),this.setState({message:""}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"compose"},s.a.createElement(S.a,{id:"message-input",className:"compose-input",placeholder:"Write message here...",value:this.state.message,onChange:this.onChange,onKeyPress:this.onKeyPress,autoFocus:!0}),s.a.createElement(C.a,{variant:"contained",color:"primary",className:"submit-button",onClick:this.onSubmit},"Send"))}}]),t}(a.Component)),N=n(107),I=n.n(N),R=n(108),M=n(216),U=n.n(M),T=new(function(){function e(t){Object(u.a)(this,e),this.domain=t||"http://localhost:8000",this.fetch=this.fetch.bind(this),this.login=this.login.bind(this),this.getUserInfo=this.getUserInfo.bind(this)}return Object(m.a)(e,[{key:"login",value:function(e,t){var n=this;return this.fetch("/auth/login",{method:"POST",body:JSON.stringify({username:e,password:t})}).then((function(e){return n.saveUserInfo(e),Promise.resolve(e)}))}},{key:"register",value:function(e,t,n){return this.fetch("/auth/register",{method:"POST",body:JSON.stringify({username:e,password:n,email:t})})}},{key:"loggedIn",value:function(){var e=this.getToken();return!!e&&!this.isTokenExpired(e)}},{key:"isTokenExpired",value:function(e){try{return U()(e).exp<Date.now()/1e3}catch(t){return!1}}},{key:"saveUserInfo",value:function(e){localStorage.setItem("userInfo",JSON.stringify(e))}},{key:"getUserInfo",value:function(){return JSON.parse(localStorage.getItem("userInfo"))}},{key:"getToken",value:function(){return null==this.getUserInfo()?null:this.getUserInfo().token}},{key:"logOut",value:function(){localStorage.removeItem("userInfo")}},{key:"simpleFetch",value:function(e,t){var n=this,a=this.domain+e,s={Accept:"application/json","Content-Type":"application/json;charset=UTF-8"};return this.loggedIn()&&(s.Authorization="Bearer "+this.getToken()),fetch(a,Object(R.a)({headers:s},t)).then((function(e){return n._checkStatus(e)}))}},{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var n=this,a=this.domain+e,s={Accept:"application/json","Content-Type":"application/json;charset=UTF-8"};return this.loggedIn()&&(s.Authorization="Bearer "+this.getToken()),fetch(a,Object(R.a)({headers:s},t)).then((function(e){return n._checkStatus(e)})).then((function(e){return e.json()}))}))},{key:"_checkStatus",value:function(e){var t,n;return I.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(e.status>=200&&e.status<300)){a.next=2;break}return a.abrupt("return",e);case 2:return 403===e.status&&this.logOut(),a.next=5,I.a.awrap(e.json());case 5:throw t=a.sent.message,(n=new Error(e.status+":  "+t)).response=e,n;case 9:case"end":return a.stop()}}),null,this)}}]),e}())("https://webchat-backend.herokuapp.com"),A=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={navigate:!1},n.logout=n.logout.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"logout",value:function(){T.logOut(),this.props.onLogout(),this.setState({navigate:!0})}},{key:"render",value:function(){return this.state.navigate?s.a.createElement(c.a,{to:"/login"}):s.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:this.logout},"Logout")}}]),t}(a.Component),D=function e(t,n,a){Object(u.a)(this,e),this.content=t,this.type=n,this.chatRoomId=a},x=function e(t,n,a){Object(u.a)(this,e),this.sender=t,this.content=n,this.isMine=a};function F(e){return function(t){function n(e){var t;return Object(u.a)(this,n),(t=Object(h.a)(this,Object(d.a)(n).call(this,e))).state={username:null,roles:[]},t}return Object(p.a)(n,t),Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this;T.loggedIn()?T.fetch("/user").then((function(t){return e.setState({username:t.username,roles:t.roles})})).catch((function(e){return console.log(e)})):this.props.history.replace("/login")}},{key:"render",value:function(){return this.state.username?s.a.createElement(e,{history:this.props.history,username:this.state.username,isAdmin:this.state.roles.some((function(e){return"ROLE_ADMIN"===e.name}))}):null}}]),n}(a.Component)}n(297);var P=n(189),B=n(132),J=F(function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={subscription:null,chatRoomId:null,messages:[],conversations:[]},n.username=n.props.username,n.onConnected=n.onConnected.bind(Object(f.a)(n)),n.onError=n.onError.bind(Object(f.a)(n)),n.disconnect=n.disconnect.bind(Object(f.a)(n)),n.sendMessage=n.sendMessage.bind(Object(f.a)(n)),n.onMessageReceived=n.onMessageReceived.bind(Object(f.a)(n)),n.onChatRoomSelected=n.onChatRoomSelected.bind(Object(f.a)(n));var a=new v.a("https://webchat-backend.herokuapp.com/ws");return n.client=E.a.over(a),n.client.connect({Authorization:"Bearer ".concat(T.getToken())},n.onConnected,n.onError),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"onConnected",value:function(){}},{key:"onError",value:function(e){console.log(e)}},{key:"onChatRoomSelected",value:function(e){var t=this,n=this.state.subscription;null!==n&&n.unsubscribe(),T.fetch("/room/"+e).then((function(e){return e.chatMessages.map((function(e,n){return new x(e.sender,e.content,e.sender===t.username)}))})).then((function(n){return t.setState({messages:Array.from(n),chatRoomId:e,subscription:t.client.subscribe("/topic/room/".concat(e),t.onMessageReceived)})})).catch((function(e){return console.log(e.message)}))}},{key:"sendMessage",value:function(e){var t=this.state,n=t.subscription,a=t.chatRoomId;if(null!==n){var s=new D(e,"CHAT",this.state.chatRoomId),o=new x(this.username,e,!0);this.client.send("/chat/sendMessage/".concat(a),{},JSON.stringify(s)),this.setState({messages:[].concat(Object(l.a)(this.state.messages),[o])})}}},{key:"onMessageReceived",value:function(e){var t=JSON.parse(e.body),n=new x(t.sender,t.content,!1);n.sender!==this.username&&("JOIN"===n.type&&(n.content="Entered the room"),"LEAVE"===n.type&&(n.content="Left the room"),this.setState({messages:[].concat(Object(l.a)(this.state.messages),[n])}))}},{key:"componentDidMount",value:function(){var e=this;T.fetch("/room").then((function(t){return e.setState({conversations:t})})).catch((function(e){return console.log(e.message)}))}},{key:"disconnect",value:function(){this.client.disconnect()}},{key:"render",value:function(){return s.a.createElement("div",{className:"messenger"},s.a.createElement("div",{className:"top-bar"},s.a.createElement(P.a,null,s.a.createElement(B.a,{variant:"h6",className:"app-header"},"Webchat"),this.props.isAdmin&&s.a.createElement(C.a,{variant:"contained",color:"default",href:"/admin"},"Admin console"),s.a.createElement(C.a,{variant:"contained",color:"primary",href:"/me"},this.username),s.a.createElement(A,{onLogout:this.disconnect}))),s.a.createElement("div",{className:"scrollable left-sidebar"},s.a.createElement(k,{conversations:this.state.conversations,chooseConversation:this.onChatRoomSelected})),s.a.createElement("div",{className:"scrollable content"},s.a.createElement(y,{messages:this.state.messages})),s.a.createElement("div",{className:"bottom-bar"},s.a.createElement(w,{onSubmitMessage:this.sendMessage})))}}]),t}(a.Component)),L=n(95),K=(n(190),n(430)),_=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={username:"",email:"",password:""},n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(L.a)({},e.target.id,e.target.value))}},{key:"componentDidMount",value:function(){T.loggedIn()&&this.props.history.replace("/")}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),T.register(this.state.username,this.state.email,this.state.password).then((function(){return t.props.history.replace("/login")})).catch((function(e){return alert(e.message.message)}))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("form",{className:"signup-form",onSubmit:this.onSubmit},s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("label",{htmlFor:"username"},"Username"),s.a.createElement("input",{id:"username",placeholder:"Username",value:this.state.username,onChange:this.handleChange})),s.a.createElement("li",null,s.a.createElement("label",{htmlFor:"email"},"Email"),s.a.createElement("input",{id:"email",type:"email",placeholder:"Email",value:this.state.email,onChange:this.handleChange})),s.a.createElement("li",null,s.a.createElement("label",{htmlFor:"password"},"Password"),s.a.createElement("input",{id:"password",type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange})),s.a.createElement("li",null,s.a.createElement("button",{type:"submit",onClick:this.handleSubmit},"Signup")))),s.a.createElement("p",null,"Already have an account? Login ",s.a.createElement(K.a,{href:"/login"},"here")))}}]),t}(a.Component),V=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={username:"",password:"",message:""},n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.login=n.login.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(L.a)({},e.target.id,e.target.value))}},{key:"login",value:function(e){var t=this;return I.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:this.setState({message:""}),e.preventDefault(),T.login(this.state.username,this.state.password).then((function(e){t.props.history.replace("/")})).catch((function(e){return alert(e.message)}));case 3:case"end":return n.stop()}}),null,this)}},{key:"componentDidMount",value:function(){T.loggedIn()&&this.props.history.replace("/")}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("form",{className:"signup-form",onSubmit:this.onSubmit},this.state.message,s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("label",{htmlFor:"username"},"Username"),s.a.createElement("input",{id:"username",placeholder:"Username",value:this.state.username,onChange:this.handleChange})),s.a.createElement("li",null,s.a.createElement("label",{htmlFor:"password"},"Password"),s.a.createElement("input",{id:"password",type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange})),s.a.createElement("li",null,s.a.createElement("button",{onClick:this.login},"Login")))),s.a.createElement("p",null,"Haven't got an account? Register ",s.a.createElement(K.a,{href:"/signup"},"here")))}}]),t}(a.Component),W=(n(298),F(function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={username:"",firstName:"",email:""},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;T.fetch("/user").then((function(t){e.setState(Object(R.a)({},t))})).catch((function(e){return console.log(e.message)}))}},{key:"render",value:function(){return s.a.createElement("div",{className:"userinfo"},s.a.createElement("div",{className:"userinfo-line"},s.a.createElement("div",{className:"label-container"},s.a.createElement("label",null,"Email")),s.a.createElement("div",{className:"value-container"},s.a.createElement("label",null,this.state.email))),s.a.createElement("div",{className:"userinfo-line"},s.a.createElement("div",{className:"label-container"},s.a.createElement("label",null,"Username")),s.a.createElement("div",{className:"value-container"},s.a.createElement("label",null,this.state.username))),s.a.createElement("div",{className:"userinfo-line"},s.a.createElement("div",{className:"label-container"},s.a.createElement("label",null,"First name")),s.a.createElement("div",{className:"value-container"},s.a.createElement("label",null,this.state.firstName))))}}]),t}(a.Component))),z=n(133),H=n.n(z),$=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={users:[]},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;T.fetch("/admin/users").then((function(t){return e.setState({users:t})})).catch((function(e){return console.log(e.message)}))}},{key:"banUser",value:function(e){var t=this;T.simpleFetch("/admin/ban/".concat(e)).then((function(n){return t.setState((function(t){return t.users.find((function(t){return t.id===e})).status="BANNED",t}))})).catch((function(e){return alert(e.message)}))}},{key:"activateUser",value:function(e){var t=this;T.simpleFetch("/admin/activate/".concat(e)).then((function(n){return t.setState((function(t){return t.users.find((function(t){return t.id===e})).status="ACTIVE",t}))})).catch((function(e){return alert(e.message)}))}},{key:"getActionButton",value:function(e){var t=this;return"ACTIVE"===e.status?{icon:"block",tooltip:"Ban user",onClick:function(e,n){return t.banUser(n.id)}}:{icon:"replay",tooltip:"Unban user",onClick:function(e,n){return t.activateUser(n.id)}}}},{key:"render",value:function(){var e=this;return s.a.createElement(H.a,{columns:[{title:"Id",field:"id",editable:"never"},{title:"Username",field:"username"},{title:"FirstName",field:"firstName"},{title:"Email",field:"email"},{title:"Status",field:"status"},{title:"Roles",field:"roles",render:function(e){return e.roles.map((function(e){return"ROLE_ADMIN"===e.name?"ADMIN":"USER"})).join(",")}}],data:this.state.users.sort((function(e,t){return e.id>t.id})),title:"Users",actions:[function(t){return e.getActionButton(t)}]})}}]),t}(a.Component),q=(n(384),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={chatRooms:[]},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;T.fetch("/room").then((function(t){return e.setState({chatRooms:t})})).catch((function(e){return console.log(e.message)}))}},{key:"render",value:function(){var e=this;return s.a.createElement(H.a,{columns:[{title:"Id",field:"id",editable:"never"},{title:"Name",field:"name"},{title:"Description",field:"description"}],data:this.state.chatRooms,editable:{onRowDelete:function(t){return new Promise((function(n,a){T.simpleFetch("/room/".concat(t.id),{method:"DELETE"}).then((function(a){var s=e.state.chatRooms,o=s.indexOf(t);s.splice(o,1),e.setState({chatRooms:s},(function(){return n()}))})).catch((function(e){alert(e.message),a()}))}))},onRowUpdate:function(t,n){return new Promise((function(a,s){T.simpleFetch("/room/".concat(n.id),{method:"PUT",body:JSON.stringify({name:t.name,description:t.description})}).then((function(s){var o=e.state.chatRooms,r=o.indexOf(n);o[r]=t,e.setState({chatRooms:o},(function(){return a()}))})).catch((function(e){alert(e.message),s()}))}))},onRowAdd:function(t){return new Promise((function(n,a){T.simpleFetch("/room/create",{method:"POST",body:JSON.stringify({name:t.name,description:t.description})}).then((function(a){var s=e.state.chatRooms;s.push(t),e.setState({chatRooms:s},(function(){return n()}))})).catch((function(e){alert(e.message),a()}))}))}},title:"Chatrooms"})}}]),t}(a.Component)),G=F(function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.isAdmin||this.props.history.replace("/")}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(q,null),s.a.createElement($,null))}}]),t}(a.Component)),Q=n(191),X=function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.token;T.simpleFetch("/email/confirm/".concat(t)).then((function(t){return e.props.history.replace("/")})).catch((function(e){return alert(e.message)}))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(Q.a,{disableShrink:!0}))}}]),t}(a.Component);n(385);var Y=function(){return s.a.createElement(i.a,null,s.a.createElement(c.d,null,s.a.createElement(c.b,{exact:!0,path:"/login",component:V}),s.a.createElement(c.b,{exact:!0,path:"/signup",component:_}),s.a.createElement(c.b,{exact:!0,path:"/me",component:W}),s.a.createElement(c.b,{exact:!0,path:"/admin",component:G}),s.a.createElement(c.b,{exact:!0,path:"/confirm/:token",component:X}),">",s.a.createElement(c.b,{exact:!0,path:"/",component:J})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[245,1,2]]]);
//# sourceMappingURL=main.ead7dbdf.chunk.js.map